<!-- ReportCtrl -->
<div ng-controller="ReportFiltersCtrl" ng-init="init();display='calendar'" class="report">
<div class="container">
<div class="row">
    <div class="col-md-12">
        <h2 class="page-header">Review reports
            <small>by month, project and employee</small>
        </h2>
    </div>
</div>
<div class="row">
    <div class="col-md-2">
        <h4>Month:</h4>
        <ul class="nav nav-pills small months dropdown" style="position:relative;">
            <li>
                <a ng-click="nextVisibleMonth()" class="glyphicon glyphicon-chevron-up" style="text-align: center"></a>
            </li>
            <li ng-repeat="month in months" ng-class="month == worklog.month ? 'active' : ''">
                <a ng-click="worklog.setMonth(month)">
                    <span ng-class="{strong:month == currentMonth.name}">{{month}}</span>
                    <span ng-if="month == worklog.month" class="badge badge-default">
                        {{worklog.month.total}}
                    </span>
                </a>
                <a ng-if="month == worklog.month" ng-click="worklog.setMonth(month)" class="refresh">
                    <span class="glyphicon glyphicon-refresh"></span>
                </a>
            </li>
            <li>
                <a ng-click="prevVisibleMonth()" class="glyphicon glyphicon-chevron-down" style="text-align: center"></a>
            </li>

        </ul>
    </div>
    <div class="col-md-4" ng-init="showIneligibleProjects=true">
        <h4>Projects:</h4>
        <ul class="nav nav-pills small" style="clear:both;">
            <li ng-repeat="(project, status) in worklog.projects" 
                ng-class="{active: status.active, disabled: status.hidden, hidden: status.total == '0h' && !showIneligibleProjects}">
                <a ng-click="status.hidden || worklog.toggleProject(project)">
                    {{project}}
                            <span class="badge badge-primary" ng-if="status.total != '0h'">
                                {{status.total}}
                            </span>
                </a>
            </li>

            <li class="separator"></li>
            <li class="pull-right">
                <a ng-click="worklog.enableAllProjects()">
                    <span class="glyphicon glyphicon-plus"></span> All
                </a>
            </li>
            <li class="pull-right">
                <a ng-click="worklog.disableAllProjects()">
                    <span class="glyphicon glyphicon-minus"></span> None
                </a>
            </li>
            <li class="pull-right">
                <a ng-click="showIneligibleProjects=false" ng-show="showIneligibleProjects">
                    <span class="glyphicon glyphicon-eye-close"></span> Hide ineligible
                </a>
                <a ng-click="showIneligibleProjects=true" ng-show="!showIneligibleProjects">
                    <span class="glyphicon glyphicon-eye-open"></span> Show ineligible
                </a>
            </li>
        </ul>
    </div>
    <div class="col-md-6" ng-init="showIneligibleEmployees=false">
        <h4>Employees:</h4>
        <ul class="nav nav-pills small">
            <li ng-repeat="(employee, status) in worklog.employees" 
                ng-class="{active: status.active, disabled: status.hidden, hidden: status.total == '0h' && !showIneligibleEmployees}">
                <a ng-click="status.hidden || worklog.toggleEmployee(employee)">
                    {{employee}}
                    <span class="badge badge-primary" ng-if="status.total != '0h'">
                        {{status.total}}
                    </span>
                </a>
            </li>

            <li class="separator"></li>
            <li class="pull-right">
                <a ng-click="worklog.enableAllEmployees()">
                    <span class="glyphicon glyphicon-plus"></span> All
                </a>
            </li>
            <li class="pull-right">
                <a ng-click="worklog.disableAllEmployees()">
                    <span class="glyphicon glyphicon-minus"></span> None
                </a>
            </li>
            <li class="pull-right">
                <a ng-click="showIneligibleEmployees=false" ng-show="showIneligibleEmployees">
                    <span class="glyphicon glyphicon-eye-close"></span> Hide ineligible
                </a>
                <a ng-click="showIneligibleEmployees=true" ng-show="!showIneligibleEmployees">
                    <span class="glyphicon glyphicon-eye-open"></span> Show ineligible
                </a>
            </li>
        </ul>
    </div>
</div>
<div class="row">
    <div class="col-md-12">
        <h2>{{worklog.month.toString()}}</h2>
        <ul class="nav nav-pills small">
            <li ng-class="{active: display=='calendar'}" ng-click="display='calendar'">
                <a title="Calendar">
                <span class="glyphicon glyphicon-calendar"></span>
                </a>
            </li>
            <li ng-class="{active: display=='table'}" ng-click="display='table'">
                <a title="Table">
                <span class="glyphicon glyphicon-th-list"></span>
                </a>
            </li>
            <li ng-class="{active: display=='pie-chart'}" ng-click="display='pie-chart'">
                <a title="Chart">
                <span class="glyphicon glyphicon-stats"></span>
                </a>
            </li>
        </ul>
    </div>
</div>
<div class="row" ng-show="display=='calendar'" ng-controller="MonthlyReportCtrl" ng-init="init()">
    <table class="table table-striped table-condensed calendar">
        <thead>
            <tr>
                <th class="employee">
                    Employee
                </th>
                <th ng-repeat="day in days" ng-class="{weekend: day.holiday}">
                   <div>{{day.number}}</div>
                    {{day.name}}
                </th>
                <th class="total">
                    Total
                </th>
            </tr>
        </thead>
        <tbody>
            <tr ng-repeat="(employee, hours) in report.employees()">
                <td class="employee">{{employee}}</td>
                <td ng-repeat="day in days" ng-class="{weekend: day.holiday}">
                    {{hours[day.id]}}
                </td>
                <td class="total">{{hours.total}}</td>
            </tr>
        </tbody>
        <tfoot>
            <tr>
                <td class="employee">Total</td>
                <td ng-repeat="day in days" ng-class="{weekend: day.holiday}">
                    {{report.total()[day.id]}}
                </td>
                <td class="total">{{report.total().total}}</td>
            </tr>
        </tfoot>
    </table>
</div>
<div class="row" ng-show="display=='table'">
    <table class="table table-striped">
        <thead>
        <tr>
            <th style="width: 40px"></th>
            <th>Project</th>
            <th>Workload</th>
            <th>Employee</th>
            <th ng-click="sort.predicate = 'day'; sort.reverse=!sort.reverse">
				Date
				<span class="glyphicon" ng-class="sort.reverse ? 'glyphicon-chevron-down' : 'glyphicon-chevron-up'"></span>
			</th>
        </tr>
        </thead>
        <tr class="worklog-entry" ng-repeat="item in worklog.entries | orderBy:sort.predicate:sort.reverse track by item.id">
            <td align="right">
				&nbsp;
                <a ng-click="worklog.remove(item.id)" ng-if="item.employee == currentUser">
                    <span class="glyphicon glyphicon-trash small-glyph"/>
                </a>
            </td>
            <td>
                <a ng-controller="EditCtrl" ng-click="open(item)" ng-if="item.employee == currentUser">
                    {{item.projectName}} <span class="glyphicon glyphicon-pencil small-glyph hover-edit"/>
                </a>
                <span ng-if="item.employee != currentUser">{{item.projectName}}</span>
	    	</td>
            <td>
                <a ng-controller="EditCtrl" ng-click="open(item)" ng-if="item.employee == currentUser">
                    {{item.workload}} <span style="font-size: 80%" class="glyphicon glyphicon-pencil small-glyph hover-edit"/>
                </a>
                <span ng-if="item.employee != currentUser">{{item.workload}}</span>
	    	</td>
            <td>{{item.employee}}</td>
            <td>{{item.day}}</td>
        </tr>
    </table>
</div>
<div class="row" ng-show="display=='pie-chart'" ng-controller="PieChartReportCtrl" ng-init="init()">
    <div class="col-md-5 col-md-offset-1">
        <canvas id="projectShare" width="400" height="400"></canvas>
    </div>
    <div class="col-md-5">
        <table class="table table-striped">
            <thead>
            <tr>
                <th></th>
                <th>Project</th>
                <th>Workload</th>
                <th>Share</th>
            </tr>
            </thead>
            <tr class="worklog-entry" ng-repeat="project in projects">
                <td>
                    <div style="margin-left:auto;margin-right:auto;width: 16px; height:16px; background-color:{{colorFor(project.name)}}"></div>
                </td>
                <td>{{project.name}}</td>
                <td>{{project.total}}</td>
                <td>{{project.share}}</td>
            </tr>
        </table>
    </div>
</div>
</div>
</div>
<!-- /ReportCtrl -->
